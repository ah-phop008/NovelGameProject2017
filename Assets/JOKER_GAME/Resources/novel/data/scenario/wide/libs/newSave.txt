;-save ------------------
*savestart

;セーブ画面

[bg_new name="background" layer="background" storage="save_load_background"]
[bg_show name="background" ]

@image_new storage="close" layer=ui name="button_close_save" x=5.2 y=4.0 scale=1.5

[calc exp="tmp.image_y=4.3"]
[calc exp="tmp.text_date_y=240"]
[calc exp="tmp.text_y=220"]

[saveloop]

[calc exp="tmp.image_y={tmp.image_y}-1.2"]
[calc exp="tmp.text_y= {tmp.text_y}-60"]
[calc exp="tmp.text_date_y={tmp.text_date_y}-60"]

[trace exp="save"]

@image_new storage="save" layer=ui name="{save.name}" tag="save_button" x=4 y={tmp.image_y} scale=1.5
@text_new name="text_date_{save.name}" fontsize="14" anchor="MiddleLeft" cut=20 val="{save.date}" tag="samune" x=-200 y={tmp.text_date_y}
@text_new name="text_{save.name}" fontsize="14" anchor="MiddleLeft" cut=20 val="{save.title}" tag="samune" x=-200 y={tmp.text_y}

/*
[if exp="{save.img}!=''"]
[image_new name="{save.name}_img" path=true storage="{save.img}" tag="save_button" x=-4 scale=0.25 y={tmp.tm_y} ]
[else]
[endif]
*/

[end_saveloop]

[image_show  time=0 tag=save_button]
@image_show name="button_close_save" time=0
@image_show tag=samune time=0

[evt tag="save_button" act="click" target="*click_save" ]
[evt name="button_close_save" act="click" target="close_save"]
[s]

*click_save 
;セーブ実行
;{evt.caller_name}がクリックされました[p]
;どうなってますか[p]
[save name="{evt.caller_name}"]

[jump scene=new target=*savestart]

*close_save
[awakegame]
[s]
;-----------------------


;-load ------------------
*loadstart

;ロード画面

;背景の定義、表示
[bg_new name="background" layer="background" storage="save_load_background"]
[bg_show name="background" ]

;戻るボタン
@image_new storage="close" layer=ui tag="otherbutton" name="button_close_save" x=4.8 y=-4.0 scale_x=9.0 scale_y=2
;ページスクロール
[image_new storage="RightArrow_Button" layer=ui tag="otherbutton" name="right" x=1.5 y=-3.86 scale=1.2]
[image_new storage="LeftArrow_Button" layer=ui tag="otherbutton" name="left" x=-1.2 y=-3.86 scale=1.2]

;ボタン表示
[image_show tag="otherbutton" time=0]
;現在のページ
[calc exp="f.pagenum=0"]


*loadpage_update

;変数定義
;セーブボタンの座標
[calc exp="tmp.image_y=3.2"]
;
[calc exp="tmp.tm_y=5.15"]
;セーブデータの日付
[calc exp="tmp.text_date_y=160"]
;セーブデータの内容
[calc exp="tmp.text_y=130"]
;左か右かのフラグ
[calc exp="f.i=0"]



[saveloop num="6" page={f.pagenum}]

[trace exp="save"]

[if exp="{f.i} == 0"]

@image_new storage="load" layer=ui name="{save.name}" tag="save_button" x=-1.2 y={tmp.image_y} scale=1.5
@text_new name="text_date_{save.name}" anchor="MiddleLeft" cut=20 val="{save.date}" color="000000" tag="samune" x=-230 y={tmp.text_date_y}
@text_new name="text_{save.name}" anchor="MiddleLeft" cut=12 val="{save.title}" fontsize="18" color="000000" tag="samune" x=-230 y={tmp.text_y}
[calc exp="f.i = 1"] 

[else]

@image_new storage="load" layer=ui name="{save.name}" tag="save_button" x=6.45 y={tmp.image_y} scale=1.5
@text_new name="text_date_{save.name}" anchor="MiddleLeft" cut=20 val="{save.date}" color="000000" tag="samune" x=142 y={tmp.text_date_y}
@text_new name="text_{save.name}" anchor="MiddleLeft" cut=12 val="{save.title}" fontsize="18" color="000000" tag="samune" x=142 y={tmp.text_y}
[calc exp="f.i = 0"]
[calc exp="tmp.image_y = {tmp.image_y} - 2.6"]
[calc exp="tmp.text_date_y = {tmp.text_date_y} - 130"]
[calc exp="tmp.text_y = {tmp.text_y} - 130"]

[endif]


;[trace exp="save"]

;@image_new storage="load" layer=ui name="{save.name}" tag="save_button" x=4 y={tmp.image_y} scale=1.5
;@text_new name="text_date_{save.name}" anchor="MiddleLeft" cut=20 val="{save.date}" color="000000" tag="samune" x=-200 y={tmp.text_date_y}
;@text_new name="text_{save.name}" anchor="MiddleLeft" cut=20 val="{save.title}" color="000000" tag="samune" x=-200 y={tmp.text_y}



/*
[if exp="{save.img}!=''"]
[image_new name="{save.name}_img" path=true storage="{save.img}" tag="save_button" x=-4 scale=0.25 y={tmp.tm_y} ]
[else]
[endif]
*/

[end_saveloop num="6" page={f.pagenum}]

@get_autosave var=auto

[if exp="{auto.name!=''}"]


[calc exp="tmp.image_y={tmp.image_y}-1.2"]
[calc exp="tmp.text_y= {tmp.text_y}-60"]
[calc exp="tmp.text_date_y={tmp.text_date_y}-60"]

;自動セーブ
@text_new name="text_auto" anchor="MiddleLeft" cut=20 val="自動セーブ" tag="samune" x=0.227 y=0.205
@button_new storage="load" layer=ui name="{auto.name}" tag="save_button" x=4 y={tmp.image_y} scale=1.5
@text_new name="text_date_{auto.name}" anchor="MiddleLeft" cut=20 val="{auto.date}" tag="samune" x=0.27 y={tmp.text_date_y}
@text_new name="text_{auto.name}" anchor="MiddleLeft" cut=20 val="{auto.title}" tag="samune" x=0.27 y={tmp.text_y}


[endif]

[image_show  time=0 tag=save_button]

@image_show tag=samune time=0

[evt tag="save_button" act="click" target="*click_load" ]
[evt name="button_close_save" act="click" target="close_load"]

;ページ移動ボタンのイベント
[evt name="right" act="click" target="*moveright"]
[evt name="left" act="click" target="*moveleft"]


[s]


*click_load 
;ロード実行
;{evt.caller_name}がクリックされました[p]
[load name="{evt.caller_name}"]

[s]

*close_load
[awakegame]
[s]


*moveright


[calc exp="f.pagenum = {f.pagenum} + 1"]

[if exp="{f.pagenum} == 3"]
[calc exp="f.pagenum = 0"]
[endif]

[jump target="reload_button"]
[s]

*moveleft
[calc exp="f.pagenum = {f.pagenum} - 1"]

[if exp="{f.pagenum} == -1"]
[calc exp="f.pagenum = 2"]
[endif]

[jump target="reload_button"]
[s]

*reload_button
;更新するUIの前の状態を削除
[image_remove name="save_0" ]
[text_remove name="text_date_save_0" ]
[text_remove name="text_save_0"]
[image_remove name="save_1" ]
[text_remove name="text_date_save_1" ]
[text_remove name="text_save_1"]
[image_remove name="save_2" ]
[text_remove name="text_date_save_2" ]
[text_remove name="text_save_2"]
[image_remove name="save_3" ]
[text_remove name="text_date_save_3" ]
[text_remove name="text_save_3"]
[image_remove name="save_4" ]
[text_remove name="text_date_save_4" ]
[text_remove name="text_save_4"]
[image_remove name="save_5" ]
[text_remove name="text_date_save_5" ]
[text_remove name="text_save_5"]

;ページ数とセーブファイルナンバーの更新
[jump target="loadpage_update"]
[s]

;-----------------------
